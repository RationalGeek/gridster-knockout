/*!
 * gridster-knockout v0.0.1
 * (c) Justin Kohlhepp - 
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */

ko.bindingHandlers.gridster={init:function(a,b,c,d,e){for(var f=$(a).data("gridster"),g=b().items,h=ko.unwrap(b().templateName),i=$("#"+h).html(),j=1,k=0;k<g().length;k++){var l=g()[k];l.widgetId&&l.widgetId()>=j&&(j=parseInt(l.widgetId())+1)}for(var m=function(a){var c=void 0!==a.col?parseInt(a.col()):null,d=void 0!==a.row?parseInt(a.row()):null,g=parseInt(a.size_x()),h=parseInt(a.size_y()),k=f.add_widget(i,g,h,c,d);void 0===a.col&&(a.col=ko.observable(k.attr("data-col"))),void 0===a.row&&(a.row=ko.observable(k.attr("data-row"))),void 0===a.widgetId&&(a.widgetId=ko.observable(),a.widgetId(j++)),k.attr("data-widgetId",a.widgetId()),a.gridsterElement=k.get(0);var l=e.createChildContext(a,null,function(a){ko.utils.extend(a,b())});return ko.applyBindingsToDescendants(l,k.get(0)),k},n=function(a){for(var b=0;b<g().length;b++){var c=g()[b];if(c.widgetId()==a)return c}return null},k=0;k<g().length;k++)l=g()[k],m(l);g.subscribe(function(a){a.forEach(function(a){switch(a.status){case"added":{m(a.value)}break;case"deleted":f.remove_widget(a.value.gridsterElement);break;default:throw new Error("Unexpected change.status")}})},null,"arrayChange");var o=function(){for(var a=0;a<g().length;a++){var b=g()[a],c=$(b.gridsterElement).attr("data-col"),d=$(b.gridsterElement).attr("data-row");b.col(c),b.row(d)}},p=f.options.resize.stop;f.options.resize.stop=function(a,b,c){var d=c.attr("data-widgetId"),e=c.attr("data-sizex"),f=c.attr("data-sizey"),g=n(d);g.size_x(e),g.size_y(f),o(),void 0!==p&&p(a,b,c)};var q=f.options.draggable.stop;return f.options.draggable.stop=function(a,b){o(),void 0!==q&&q(a,b)},{controlsDescendantBindings:!0}}};